---
import type { Language } from "../i18n/types";
import { getI18n } from "../i18n/utils";

interface Props {
  language?: Language;
  canonical?: string;
}

const { language = "en", canonical } = Astro.props;
const i18n = getI18n(language);
const currentYear = new Date().getFullYear();
const officeLocationTitle = language === "es" ? "Ubicaciones" : "Locations";
const quickLinksTitle = language === "es" ? "Enlaces rápidos" : "Quick Links";
const contactTitle = language === "es" ? "Contacto" : "Contact";
const phoneLabel = language === "es" ? "Teléfono" : "Phone";
const emailLabel = "Email";
const officeHoursLabel = language === "es" ? "Horario de oficina" : "Office Hours";
const weekdayHours = language === "es" ? "Lun - Vie: 9:00 AM - 6:00 PM" : "Mon - Fri: 9:00 AM - 6:00 PM";
const weekendHours = language === "es" ? "Sáb - Dom: Con cita previa" : "Sat - Sun: By Appointment";
const googleReviewsText = language === "es" ? "Reseñas de Google" : "Google reviews";
const accessibilityText = language === "es" ? "Accesibilidad" : "Accessibility";
const privacyText = language === "es" ? "Política de privacidad" : "Privacy Policy";
const termsText = language === "es" ? "Términos y condiciones" : "Terms & Conditions";
const rightsReservedText =
  language === "es"
    ? "Arizona Family Connections. Todos los derechos reservados."
    : "Arizona Family Connections. All rights reserved.";
const footerAriaLabel = language === "es" ? "Pie del sitio" : "Site footer";
const footerNavAriaLabel = language === "es" ? "Navegación del pie de página" : "Footer navigation";
const legalAriaLabel = language === "es" ? "Enlaces legales" : "Legal links";
const officeLocations = [
  { label: "Phoenix", slug: "phoenix" },
  { label: "Kingman", slug: "kingman" },
  { label: "Prescott", slug: "prescott" },
  { label: "Portland", slug: "portland" },
];
const googleReviewsUrl = "https://www.google.com/maps/place/Arizona+Family+Connections/";
const legalBasePath = language === "es" ? "/es/legal" : "/legal";
const locationBasePath = language === "es" ? "/es/locations" : "/locations";

// Generate language URLs
const rawPath = canonical ?? Astro.url.pathname;
let currentPath = rawPath;

// Canonical can be absolute (e.g. https://domain.com/schedule); normalize to pathname.
if (/^https?:\/\//i.test(rawPath)) {
  try {
    currentPath = new URL(rawPath).pathname;
  } catch {
    currentPath = Astro.url.pathname;
  }
}

// Remove language prefix if present and normalize trailing slash
const basePath = currentPath.replace(/^\/(en|es)/, "").replace(/\/+$/, "");

// EN: no prefix
const enUrl = basePath === "" ? "/" : `${basePath}/`;

// ES: add /es prefix, normalize root
const normalizedBasePath = basePath === "" ? "/" : basePath;
const esUrl = normalizedBasePath === "/" ? "/es/" : `/es${normalizedBasePath}/`;
---

<footer class="footer" aria-label={footerAriaLabel}>
  <div class="footer-container">
    <!-- Main Footer Content -->
    <div class="footer-content">
      <!-- Logo -->
      <div class="footer-section">
        <a href="/" class="footer-logo">
          <img
            src="/images/logo-dark.svg"
            alt="Arizona Family Connections"
            loading="lazy"
            width="200"
            height="60"
          />
        </a>
        <ul class="footer-social">
          <li>
            <a href="https://www.facebook.com/people/Arizona-Family-Connections/100091233937197/" aria-label="Facebook" class="social-link" target="_blank" rel="noopener">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 16 16"
                aria-hidden="true"
                focusable="false"
              >
                <path
                  fill="currentColor"
                  d="M7.2 16V8.5h-2V5.8h2V3.5C7.2 1.7 8.4 0 11.1 0c1.1 0 1.9.1 1.9.1l-.1 2.5h-1.7c-1 0-1.1.4-1.1 1.2v2H13l-.1 2.7h-2.8V16H7.2z"
                />
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.instagram.com/azfamilyconnections" aria-label="Instagram" class="social-link" target="_blank" rel="noopener">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                aria-hidden="true"
                focusable="false"
              >
                <path
                  fill="currentColor"
                  d="M17.34 5.46a1.2 1.2 0 1 0 1.2 1.2a1.2 1.2 0 0 0-1.2-1.2Zm4.6 2.42a7.59 7.59 0 0 0-.46-2.43a4.94 4.94 0 0 0-1.16-1.77a4.7 4.7 0 0 0-1.77-1.15a7.3 7.3 0 0 0-2.43-.47C15.06 2 14.72 2 12 2s-3.06 0-4.12.06a7.3 7.3 0 0 0-2.43.47a4.78 4.78 0 0 0-1.77 1.15a4.7 4.7 0 0 0-1.15 1.77a7.3 7.3 0 0 0-.47 2.43C2 8.94 2 9.28 2 12s0 3.06.06 4.12a7.3 7.3 0 0 0 .47 2.43a4.7 4.7 0 0 0 1.15 1.77a4.78 4.78 0 0 0 1.77 1.15a7.3 7.3 0 0 0 2.43.47C8.94 22 9.28 22 12 22s3.06 0 4.12-.06a7.3 7.3 0 0 0 2.43-.47a4.7 4.7 0 0 0 1.77-1.15a4.85 4.85 0 0 0 1.16-1.77a7.59 7.59 0 0 0 .46-2.43c0-1.06.06-1.4.06-4.12s0-3.06-.06-4.12ZM20.14 16a5.61 5.61 0 0 1-.34 1.86a3.06 3.06 0 0 1-.75 1.15a3.19 3.19 0 0 1-1.15.75a5.61 5.61 0 0 1-1.86.34c-1 .05-1.37.06-4 .06s-3 0-4-.06a5.73 5.73 0 0 1-1.94-.3a3.27 3.27 0 0 1-1.1-.75a3 3 0 0 1-.74-1.15a5.54 5.54 0 0 1-.4-1.9c0-1-.06-1.37-.06-4s0-3 .06-4a5.54 5.54 0 0 1 .35-1.9A3 3 0 0 1 5 5a3.14 3.14 0 0 1 1.1-.8A5.73 5.73 0 0 1 8 3.86c1 0 1.37-.06 4-.06s3 0 4 .06a5.61 5.61 0 0 1 1.86.34a3.06 3.06 0 0 1 1.19.8a3.06 3.06 0 0 1 .75 1.1a5.61 5.61 0 0 1 .34 1.9c.05 1 .06 1.37.06 4s-.01 3-.06 4ZM12 6.87A5.13 5.13 0 1 0 17.14 12A5.12 5.12 0 0 0 12 6.87Zm0 8.46A3.33 3.33 0 1 1 15.33 12A3.33 3.33 0 0 1 12 15.33Z"
                />
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.yelp.com/biz/arizona-family-connections-peoria" aria-label="Yelp" class="social-link" target="_blank" rel="noopener">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                aria-hidden="true"
                focusable="false"
              >
                <path
                  fill="currentColor"
                  d="m20.16 12.594l-4.995 1.433c-.96.276-1.74-.8-1.176-1.63l2.905-4.308a1.072 1.072 0 0 1 1.596-.206a9.194 9.194 0 0 1 2.364 3.252a1.073 1.073 0 0 1-.686 1.459zm-5.025 3.152l4.942 1.606a1.072 1.072 0 0 1 .636 1.48a9.316 9.316 0 0 1-2.47 3.169a1.073 1.073 0 0 1-1.592-.26l-2.76-4.409c-.528-.847.288-1.894 1.236-1.584zm-4.796-4.368L5.454 2.916a1.072 1.072 0 0 1 .466-1.5A14.973 14.973 0 0 1 11.184.003a1.07 1.07 0 0 1 1.153 1.068v9.768c0 1.096-1.45 1.483-1.998.535zm-.857 4.17L4.44 16.806a1.073 1.073 0 0 1-1.324-.92a9.218 9.218 0 0 1 .43-3.997a1.07 1.07 0 0 1 1.485-.62l4.668 2.279c.9.438.763 1.76-.207 2zm.886 1.477c.669-.744 1.901-.246 1.866.752l-.19 5.188a1.073 1.073 0 0 1-1.247 1.02a9.314 9.314 0 0 1-3.722-1.502a1.072 1.072 0 0 1-.187-1.6l3.477-3.864z"
                />
              </svg>
            </a>
          </li>
        </ul>
        <a href={googleReviewsUrl} class="reviews-link" target="_blank" rel="noopener noreferrer">
          {googleReviewsText}
        </a>

        <div class="footer-language">
          <p class="setting-label">{i18n.language}</p>
          <div class="language-switcher" aria-label="Language selection">
            <a
              href={enUrl}
              class={`lang-link ${language === "en" ? "active" : ""}`}
              aria-current={language === "en" ? "page" : undefined}
            >
              EN
            </a>
            <a
              href={esUrl}
              class={`lang-link ${language === "es" ? "active" : ""}`}
              aria-current={language === "es" ? "page" : undefined}
            >
              ES
            </a>
          </div>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="footer-section footer-section-links">
        <h3 class="footer-section-title">{quickLinksTitle}</h3>
        <nav aria-label={footerNavAriaLabel}>
          <ul class="footer-links">
            {i18n.menuItems.map((item: { url: string; label: string }) => (
              <li>
                <a href={item.url}>{item.label}</a>
              </li>
            ))}
          </ul>
        </nav>
      </div>

      <!-- Contact Info -->
      <div class="footer-section">
        <h3 class="footer-section-title">{contactTitle}</h3>
        <div class="contact-info">
          <div class="contact-item">
            <p class="contact-label">{phoneLabel}</p>
            <a href="tel:+14807646689">Phoenix: (480) 764-6689</a>
            <a href="tel:+19712263820">Portland: (971) 226-3820</a>
          </div>
          <div class="contact-item">
            <p class="contact-label">{emailLabel}</p>
            <a href="mailto:contact@arizonafamilyconnections.com">
              contact@arizonafamilyconnections.com
            </a>
          </div>
          <div class="contact-item">
            <p class="contact-label">{officeHoursLabel}</p>
            <p>{weekdayHours}</p>
            <p>{weekendHours}</p>
          </div>
        </div>
      </div>

      <!-- Office Locations -->
      <div class="footer-section">
        <h3 class="footer-section-title">{officeLocationTitle}</h3>
        <ul class="footer-links">
          {officeLocations.map((location) => (
            <li>
              <a href={`${locationBasePath}/${location.slug}/`}>{location.label}</a>
            </li>
          ))}
        </ul>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="footer-bottom-content">
        <p class="copyright">
          &copy; {currentYear} {rightsReservedText}
        </p>
        <nav class="legal-links" aria-label={legalAriaLabel}>
          <ul class="legal-links-list">
            <li><a href={`${legalBasePath}/accessibility/`}>{accessibilityText}</a></li>
            <li><a href={`${legalBasePath}/privacy/`}>{privacyText}</a></li>
            <li><a href={`${legalBasePath}/terms/`}>{termsText}</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</footer>

<style>
  .footer {
    background: #f8faff;
    margin-top: auto;
  }

  .footer-container {
    max-width: var(--container-xl);
    margin: 0 auto;
    padding: var(--space-9) var(--pad-component-lg);
  }

  .footer-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-8);
    margin-bottom: var(--space-8);
  }

  .footer-section {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .footer-logo {
    display: inline-flex;
    max-width: 150px;
    transition: opacity var(--duration-std) var(--ease-standard);
  }

  .footer-logo:hover {
    opacity: 0.8;
  }

  .footer-logo img {
    min-width: 200px;
    height: auto;
    display: block;
  }

  .footer-section-title {
    margin: 0;
    font-size: var(--text-lg);
    font-weight: var(--weight-bold);
    color: var(--color-accent);
    line-height: 1.2;
  }

  .footer-section-text {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-text);
    line-height: var(--line-normal);
  }

  /* Social Links */
  .footer-social {
    display: flex;
    flex-direction: row;
    gap: var(--space-3);
    margin: var(--space-2) 0 0 0;
    list-style: none;
    padding: 0;
  }

  .footer-social li {
    list-style: none;
  }

  .reviews-link {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: max-content;
    margin-top: var(--space-2);
    padding: 10px 14px;
    background: var(--brand-primary-500);
    border: 1px solid transparent;
    border-radius: var(--radius-md);
    color: #fff;
    font-size: var(--text-sm);
    font-weight: var(--weight-bold);
    letter-spacing: 0.01em;
    text-decoration: none;
    box-shadow: var(--shadow-elev-1);
    transition:
      background-color var(--duration-std) var(--ease-standard),
      transform var(--duration-std) var(--ease-standard),
      box-shadow var(--duration-std) var(--ease-standard);
  }

  .reviews-link:hover {
    background: var(--brand-secondary-600);
    transform: translateY(-1px);
    box-shadow: var(--shadow-elev-2);
  }

  .reviews-link:focus-visible {
    outline: 0;
    box-shadow: var(--focus-ring);
  }

  .social-link {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--brand-primary-500);
    border-radius: var(--radius-full);
    color: white;
    transition: all var(--duration-std) var(--ease-standard);
  }

  .social-link:hover {
    background: var(--brand-secondary-600);
    transform: translateY(-2px);
  }

  /* Footer Links */
  .footer-links {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .footer-links a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: var(--text-sm);
    transition: all var(--duration-std) var(--ease-standard);
  }

  .footer-links a:hover {
    color: var(--color-text);
    padding-left: var(--space-1);
  }

  /* Contact Info */
  .contact-info {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .contact-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .contact-label {
    margin: 0;
    font-size: var(--text-xs);
    font-weight: var(--weight-bold);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .contact-item p {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-text);
  }

  .contact-item a {
    color: var(--color-text);
    text-decoration: none;
    font-size: var(--text-sm);
    transition: opacity var(--duration-std) var(--ease-standard);
  }

  .contact-item a:hover {
    opacity: var(--opacity-hover);
    color: var(--brand-primary-500);
  }

  .setting-label {
    margin: 0;
    font-size: var(--text-xs);
    font-weight: var(--weight-bold);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .language-switcher {
    display: flex;
    gap: var(--space-2);
    justify-content: flex-start;
    width: 100%;
  }

  .lang-link {
    padding: var(--space-2) var(--space-3);
    background: var(--neutral-100);
    border-radius: var(--radius-md);
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    transition: all var(--duration-std) var(--ease-standard);
    cursor: pointer;
  }

  .lang-link:hover {
    background: var(--neutral-200);
    color: var(--color-text);
  }

  .lang-link.active {
    background: var(--brand-primary-500);
    color: white;
  }

  /* Footer Bottom */
  .footer-bottom {
    border-top: 1px solid var(--neutral-200);
    padding-top: var(--space-6);
  }

  .footer-bottom-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    align-items: center;
    text-align: center;
  }

  .footer-language {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-2);
    width: 100%;
    text-align: left;
  }

  .copyright {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .legal-links {
    margin: 0;
  }

  .legal-links-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-4);
    justify-content: center;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .legal-links-list li {
    list-style: none;
  }

  .legal-links a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: var(--text-sm);
    transition: color var(--duration-std) var(--ease-standard);
  }

  .legal-links a:hover {
    color: var(--brand-primary-500);
  }

  /* Responsive */
  @media (min-width: 768px) {
    .footer-content {
      grid-template-columns: repeat(2, 1fr);
    }

    .footer-bottom-content {
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      text-align: left;
    }
  }

  @media (min-width: 1024px) {
    .footer-content {
      grid-template-columns: repeat(4, 1fr);
    }

    .footer-section-links {
      justify-self: end;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .social-link,
    .footer-links a,
    .lang-link,
    .legal-links a {
      transition: none;
    }

    .social-link:hover {
      transform: none;
    }
  }
</style>

