---
// src/components/base-head/BaseHead.astro
import type { ImageMetadata } from "astro";

interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string | ImageMetadata;
  ogImageAlt?: string;
  ogType?: "website" | "article" | "product";
  twitterHandle?: string;
  twitterCardType?: "summary" | "summary_large_image";
  robots?: string;
  author?: string;
  publishedDate?: string;
  modifiedDate?: string;
  articleTags?: string[];
  language?: string;
  colorScheme?: "light" | "dark" | "light dark";
  logoUrl?: string;
}

const {
  title,
  description,
  canonical,
  ogImage,
  ogImageAlt = "Page image",
  ogType = "website",
  twitterHandle,
  twitterCardType = "summary_large_image",
  robots = "index, follow",
  author,
  publishedDate,
  modifiedDate,
  articleTags = [],
  language = "en",
  colorScheme = "light dark",
  logoUrl = "/logo.svg",
} = Astro.props;

if (!title) {
  console.warn("[BaseHead] Missing required prop: title");
}
if (!description) {
  console.warn("[BaseHead] Missing required prop: description");
}

let ogImageUrl: string | undefined;
if (ogImage) {
  ogImageUrl = typeof ogImage === "string" ? ogImage : ogImage.src;
}

const SITE_URL =
  import.meta.env.SITE ?? "https://arizonafamilyconnections.org";
const SITE_NAME =
  import.meta.env.SITE_NAME ?? "Arizona Family Connections";
const SITE_LOCALE = language;

const canonicalUrl = canonical ? `${SITE_URL}${canonical}` : undefined;

const fullOgImageUrl = ogImageUrl
  ? ogImageUrl.startsWith("http")
    ? ogImageUrl
    : `${SITE_URL}${ogImageUrl}`
  : undefined;

const fullLogoUrl = logoUrl.startsWith("http")
  ? logoUrl
  : `${SITE_URL}${logoUrl}`;
---

<head>
  <!-- =========================================
       CORE META TAGS
       ========================================= -->
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1"
  />
  <meta name="language" content={language} />
  <meta name="color-scheme" content={colorScheme} />
  <meta name="description" content={description} />
  <meta name="robots" content={robots} />

  {author && <meta name="author" content={author} />}

  <title>{title}</title>

  <!-- =========================================
       CANONICAL URL
       ========================================= -->
  {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}

  <!-- =========================================
       OPEN GRAPH (SOCIAL SHARING)
       ========================================= -->
  <meta property="og:type" content={ogType} />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:site_name" content={SITE_NAME} />
  <meta property="og:locale" content={SITE_LOCALE} />
  {canonicalUrl && <meta property="og:url" content={canonicalUrl} />}

  {fullOgImageUrl && (
    <>
      <meta property="og:image" content={fullOgImageUrl} />
      <meta property="og:image:alt" content={ogImageAlt} />
    </>
  )}

  <!-- =========================================
       ARTICLE-SPECIFIC OG TAGS
       ========================================= -->
  {ogType === "article" && (
    <>
      {publishedDate && (
        <meta
          property="article:published_time"
          content={publishedDate}
        />
      )}
      {modifiedDate && (
        <meta
          property="article:modified_time"
          content={modifiedDate}
        />
      )}
      {author && (
        <meta property="article:author" content={author} />
      )}
      {articleTags.length > 0 &&
        articleTags.map((tag) => (
          <meta property="article:tag" content={tag} />
        ))}
    </>
  )}

  <!-- =========================================
       TWITTER CARD
       ========================================= -->
  {twitterHandle && (
    <meta name="twitter:creator" content={twitterHandle} />
  )}
  <meta name="twitter:card" content={twitterCardType} />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  {fullOgImageUrl && (
    <meta name="twitter:image" content={fullOgImageUrl} />
  )}

  <!-- =========================================
       JSON-LD SCHEMA (STRUCTURED DATA)
       ========================================= -->
  {ogType === "article" && (
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        headline: title,
        description,
        image: fullOgImageUrl ? [fullOgImageUrl] : undefined,
        datePublished: publishedDate,
        dateModified: modifiedDate || publishedDate,
        author: author
          ? {
              "@type": "Person",
              name: author,
            }
          : undefined,
        publisher: {
          "@type": "Organization",
          name: SITE_NAME,
          logo: {
            "@type": "ImageObject",
            url: fullLogoUrl,
            width: 600,
            height: 60,
          },
        },
      })}
    />
  )}

  {ogType === "website" && (
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebPage",
        name: title,
        description,
        url: canonicalUrl || SITE_URL,
        image: fullOgImageUrl,
        publisher: {
          "@type": "Organization",
          name: SITE_NAME,
          logo: {
            "@type": "ImageObject",
            url: fullLogoUrl,
            width: 600,
            height: 60,
          },
        },
      })}
    />
  )}

  {ogType === "product" && (
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Product",
        name: title,
        description,
        image: fullOgImageUrl,
        brand: {
          "@type": "Brand",
          name: SITE_NAME,
          logo: {
            "@type": "ImageObject",
            url: fullLogoUrl,
            width: 600,
            height: 60,
          },
        },
      })}
    />
  )}

  <!-- =========================================
       PRECONNECT & DNS-PREFETCH
       ========================================= -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin
  />

  <!-- =========================================
       GOOGLE FONTS (Poppins & Open Sans)
       ========================================= -->
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Open+Sans:wght@400;500;700&display=swap"
    rel="stylesheet"
  />

  <!-- =========================================
       FAVICON & APP ICONS
       ========================================= -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <!-- =========================================
       MANIFEST (PWA)
       ========================================= -->
  <link rel="manifest" href="/manifest.json" />

  <!-- =========================================
       WEB APP META
       ========================================= -->
  <meta name="theme-color" content="#06a9e7" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta
    name="apple-mobile-web-app-status-bar-style"
    content="black-translucent"
  />
  <meta
    name="apple-mobile-web-app-title"
    content={SITE_NAME}
  />

  <!-- =========================================
       SLOT FOR CUSTOM META (ANALYTICS, ETC.)
       ========================================= -->
  <slot />
</head>
