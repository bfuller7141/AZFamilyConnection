---
interface Props {
  logoUrl?: string;
  logoAlt?: string;
  ctaText?: string;
  ctaUrl?: string;
  menuItems?: Array<{
    label: string;
    url: string;
  }>;
  currentLanguage?: 'en' | 'es';
}

const {
  logoUrl = '/images/logo.svg',
  logoAlt = 'Arizona Family Connections',
  ctaText = 'Get Started',
  ctaUrl = '#',
  menuItems = [
    { label: 'Home', url: '/' },
    { label: 'About', url: '/about' },
    { label: 'Services', url: '/services' },
    { label: 'Resources', url: '/resources' },
    { label: 'Contact', url: '/contact' },
  ],
  currentLanguage = 'en',
} = Astro.props;

// Get current pathname and swap language
const currentPath = Astro.url.pathname;
const cleanPath = currentPath.replace(/^\/es/, '').replace(/^\/$/, '/') || '/';
const spanishPath = `/es${cleanPath === '/' ? '' : cleanPath}`;
const englishPath = cleanPath;

// Determine if on home page
const isHomePage = cleanPath === '/';

// Set logo based on page
const currentLogoUrl = isHomePage ? logoUrl : '/images/logo-dark.svg';

// Determine active menu item
const getIsActive = (url: string) => {
  const pathToCompare = cleanPath === '/' ? '/' : cleanPath.toLowerCase();
  const urlToCompare = url === '/' ? '/' : url.toLowerCase();
  return pathToCompare === urlToCompare;
};
---

<nav class={`navbar ${!isHomePage ? 'not-home' : ''}`} id="navbar">
  <div class="navbar-container">
    <div class="navbar-left">
      <a href="/" class="navbar-logo">
        <img src={currentLogoUrl} alt={logoAlt} />
      </a>

      <!-- Desktop Menu -->
      <ul class="navbar-menu navbar-menu-desktop">
        {
          menuItems.map((item) => (
            <li>
              <a
                href={item.url}
                class={`navbar-link ${getIsActive(item.url) ? 'active' : ''}`}
              >
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>

    <div class="navbar-right">
      <a href={ctaUrl} class="btn btn-secondary">
        {ctaText}
      </a>

      <div class="language-toggle">
        <a
          href={englishPath}
          class={`language-link ${currentLanguage === 'en' ? 'active' : ''}`}
        >
          EN
        </a>
        <span class="language-divider">/</span>
        <a
          href={spanishPath}
          class={`language-link ${currentLanguage === 'es' ? 'active' : ''}`}
        >
          ES
        </a>
      </div>

      <!-- Hamburger Menu Button -->
      <button
        class="navbar-hamburger"
        id="hamburgerBtn"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <ul class="navbar-menu navbar-menu-mobile" id="mobileMenu">
    {
      menuItems.map((item) => (
        <li>
          <a
            href={item.url}
            class={`navbar-link ${getIsActive(item.url) ? 'active' : ''}`}
          >
            {item.label}
          </a>
        </li>
      ))
    }

    <!-- Mobile Menu Footer -->
    <li class="mobile-menu-footer">
      <a href={ctaUrl} class="btn btn-secondary btn-mobile">
        {ctaText}
      </a>

      <div class="language-toggle-mobile">
        <a
          href={englishPath}
          class={`language-link ${currentLanguage === 'en' ? 'active' : ''}`}
        >
          EN
        </a>
        <span class="language-divider">/</span>
        <a
          href={spanishPath}
          class={`language-link ${currentLanguage === 'es' ? 'active' : ''}`}
        >
          ES
        </a>
      </div>
    </li>
  </ul>
</nav>

<style>
  /* =========================================
   * NAVBAR STRUCTURE
   * ========================================= */

  .navbar {
    background: none;
    border-bottom: none;
    position: fixed;
    top: 0;
    z-index: 1000;
    width: 100%;
    transform: translateY(-100%);
    transition:
      transform var(--duration-std) var(--ease-standard),
      background-color var(--duration-std) var(--ease-standard),
      backdrop-filter var(--duration-std) var(--ease-standard);
  }

  .navbar.visible {
    transform: translateY(0);
  }

  .navbar.scrolled {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow-elev-1);
  }

  /* Non-home page styling */
  .navbar-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: var(--container-xl);
    margin: 0 auto;
    padding: var(--pad-component) var(--pad-component);
    gap: var(--space-2);
  }

  /* =========================================
   * LEFT SECTION (Logo + Menu)
   * ========================================= */

  .navbar-left {
    display: flex;
    align-items: center;
    gap: 0;
  }

  .navbar-logo {
    display: inline-flex;
    align-items: center;
    text-decoration: none;
    transition: opacity var(--duration-std) var(--ease-standard);
  }

  .navbar-logo:hover {
    opacity: var(--opacity-hover);
  }

  .navbar-logo img {
    height: 55px;
    width: auto;
  }

  /* =========================================
   * DESKTOP MENU
   * ========================================= */

  .navbar-menu-desktop {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: var(--space-5);
    align-items: center;
  }

  .navbar-link {
    color: var(--color-text-inverse);
    text-decoration: none;
    font-weight: var(--weight-medium);
    font-size: var(--text-sm);
    padding: var(--space-2) 0;
    border-bottom: 3px solid transparent;
    transition: all var(--duration-std) var(--ease-standard);
  }

  .navbar.not-home .navbar-link {
    color: var(--color-text);
  }

  .navbar.scrolled .navbar-link {
    color: var(--color-text);
  }

  .navbar-link:hover,
  .navbar-link.active {
    color: var(--color-accent);
    border-bottom-color: var(--color-accent);
  }

  .navbar-link:focus-visible {
    outline: 0;
    box-shadow: var(--focus-ring);
  }

  /* =========================================
   * MOBILE MENU (Hidden by default)
   * ========================================= */

  .navbar-menu-mobile {
    display: none;
    position: fixed;
    top: 80px;
    left: 0;
    right: 0;
    width: 100%;
    flex-direction: column;
    background: var(--color-surface);
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 0;
    animation: slideDown var(--duration-std) var(--ease-decelerate);
    max-height: calc(100vh - 80px);
    overflow-y: auto;
  }

  .navbar-menu-mobile.active {
    display: flex;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .navbar-menu-mobile li {
    width: 100%;
    border-bottom: 1px solid var(--color-border);
  }

  .navbar-menu-mobile .navbar-link {
    display: block;
    width: 100%;
    padding: var(--pad-component);
    font-size: var(--text-body-lg);
    color: var(--color-text);
    text-align: left;
    border-left: 4px solid transparent;
    transition: all var(--duration-std) var(--ease-standard);
  }

  .navbar-menu-mobile .navbar-link:hover,
  .navbar-menu-mobile .navbar-link.active {
    background: var(--color-primary-subtle);
    color: var(--color-primary);
    border-left-color: var(--color-primary);
    border-bottom: 1px solid var(--color-border);
  }

  /* =========================================
   * MOBILE MENU FOOTER
   * ========================================= */

  .mobile-menu-footer {
    padding: var(--pad-component);
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    align-items: stretch;
    border-bottom: none;
  }

  .btn-mobile {
    width: 100%;
    text-align: center;
  }

  .language-toggle-mobile {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
  }

  .language-toggle-mobile .language-link {
    color: var(--color-text);
    text-decoration: none;
    padding: var(--space-1) var(--space-2);
    border-bottom: 2px solid transparent;
    transition: all var(--duration-std) var(--ease-standard);
  }

  .language-toggle-mobile .language-link:hover,
  .language-toggle-mobile .language-link.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
  }

  .language-toggle-mobile .language-divider {
    color: var(--color-text);
  }

  /* =========================================
   * RIGHT SECTION (Language + CTA + Hamburger)
   * ========================================= */

  .navbar-right {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .language-toggle {
    display: none;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-xs);
    font-weight: var(--weight-medium);
  }

  .language-link {
    color: var(--color-text-inverse);
    text-decoration: none;
    padding: var(--space-1) var(--space-3);
    margin-left: var(--space-1);
    border-bottom: 2px solid transparent;
    transition: all var(--duration-std) var(--ease-standard);
  }

  .navbar.not-home .language-link {
    color: var(--color-text);
  }

  .navbar.scrolled .language-link {
    color: var(--color-text);
  }

  .language-link:hover,
  .language-link.active {
    color: var(--color-accent);
    border-bottom-color: var(--color-accent);
  }

  .language-link:focus-visible {
    outline: 0;
    box-shadow: var(--focus-ring);
  }

  .language-divider {
    color: var(--color-text-inverse);
  }

  .navbar.not-home .language-divider {
    color: var(--color-text);
  }

  .navbar.scrolled .language-divider {
    color: var(--color-text);
  }

  .navbar-right .btn {
    display: none;
  }

  /* =========================================
   * HAMBURGER MENU BUTTON
   * ========================================= */

  .navbar-hamburger {
    display: flex;
    flex-direction: column;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: var(--space-2);
    gap: var(--space-2);
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    box-shadow: none;
  }

  .hamburger-line {
    display: block;
    width: 24px;
    height: 2px;
    background: var(--neutral-0);
    border-radius: 2px;
    transition: all var(--duration-std) var(--ease-standard);
    transform-origin: center;
  }

  .navbar.not-home .hamburger-line {
    background: var(--neutral-1000);
  }

  .navbar.scrolled .hamburger-line {
    background: var(--neutral-1000);
  }

  /* Hamburger animation - open state */
  .navbar-hamburger.active .hamburger-line:nth-child(1) {
    transform: translateY(10px) rotate(45deg);
  }

  .navbar-hamburger.active .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  .navbar-hamburger.active .hamburger-line:nth-child(3) {
    transform: translateY(-10px) rotate(-45deg);
  }

  /* =========================================
   * DESKTOP BREAKPOINT (768px+)
   * ========================================= */

  @media (min-width: 768px) {
    .navbar-menu-desktop {
      display: flex;
    }

    .navbar-menu-mobile {
      display: none !important;
    }

    .navbar-hamburger {
      display: none;
    }

    .language-toggle {
      display: flex;
    }

    .navbar-right .btn {
      display: inline-flex;
      padding: 8px 24px;
      font-size: var(--text-sm);
    }

    .navbar-container {
      padding: var(--pad-component-lg) var(--pad-component);
    }

    .navbar-left {
      gap: var(--space-6);
    }
  }

  /* =========================================
   * ACCESSIBILITY & REDUCED MOTION
   * ========================================= */

  @media (prefers-reduced-motion: reduce) {
    .navbar-link,
    .hamburger-line,
    .navbar-menu-mobile,
    .language-link,
    .navbar {
      transition: none;
    }

    .navbar-menu-mobile {
      animation: none;
    }
  }
</style>

<script is:inline>
  function setupNavbar() {
    const hamburgerBtn = document.getElementById("hamburgerBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    const navbar = document.getElementById("navbar");
    const navbarContainer = document.querySelector(".navbar-container");
    const logoImg = document.querySelector(".navbar-logo img");
    const isHomePage = !navbar?.classList.contains("not-home");

    if (hamburgerBtn && mobileMenu) {
      hamburgerBtn.addEventListener("click", () => {
        const isActive = hamburgerBtn.classList.toggle("active");
        mobileMenu.classList.toggle("active");
        hamburgerBtn.setAttribute("aria-expanded", String(isActive));

        if (isActive) {
          document.body.style.overflow = "hidden";
        } else {
          document.body.style.overflow = "";
        }
      });

      const menuLinks = mobileMenu.querySelectorAll(".navbar-link");
      menuLinks.forEach((link) => {
        link.addEventListener("click", () => {
          hamburgerBtn.classList.remove("active");
          mobileMenu.classList.remove("active");
          hamburgerBtn.setAttribute("aria-expanded", "false");
          document.body.style.overflow = "";
        });
      });

      document.addEventListener("click", (e) => {
        if (
          navbarContainer &&
          !navbarContainer.contains(e.target) &&
          navbar &&
          !navbar.contains(e.target)
        ) {
          hamburgerBtn.classList.remove("active");
          mobileMenu.classList.remove("active");
          hamburgerBtn.setAttribute("aria-expanded", "false");
          document.body.style.overflow = "";
        }
      });
    }

    // Scroll detection
    let lastScrollY = 0;
    let isScrolled = false;

    window.addEventListener("scroll", () => {
      const currentScrollY = window.scrollY;

      if (currentScrollY > 200 && !isScrolled) {
        navbar?.classList.add("scrolled");
        if (isHomePage && logoImg) logoImg.src = "/images/logo-dark.svg";
        isScrolled = true;
      } else if (currentScrollY < 50 && isScrolled) {
        navbar?.classList.remove("scrolled");
        if (isHomePage && logoImg) logoImg.src = "/images/logo.svg";
        isScrolled = false;
      }

      if (currentScrollY > lastScrollY) {
        navbar?.classList.remove("visible");
      } else {
        navbar?.classList.add("visible");
      }

      lastScrollY = currentScrollY;
    });

    if (navbar) {
      navbar.classList.add("visible");
    }
  }

  // Setup on load and on page transitions
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupNavbar);
  } else {
    setupNavbar();
  }

  // For Astro view transitions
  document.addEventListener("astro:after-swap", setupNavbar);
</script>